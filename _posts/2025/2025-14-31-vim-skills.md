---
layout: post
title: Vim 常用技巧
date: 2025-12-31 15:42:58+0800
last_updated: 2026-01-10 12:03:36+0800
description: 本文介绍自己学习到的一些好用的 Vim 技巧。
tags:
  - 中文文章
categories: Vim/Neovim
featured:
giscus_comments: true
toc:
  sidebar: left
related_posts: true
pretty_table: true
---

在 `vim` 中 `nrformats` 决定了 `CTRL-A` 和 `CTRL-X` 增减数字时所识别的数字格式，
其一般被设置成 `bin,hex` 表示会将 `0b` 和 `0B` 开头的数字识别成二进制，
`0x` 和 `0X` 开头的数字识别成十六进制。
在这些数字上使用 `CTRL-A` 和 `CTRL-X` 时会按相应的进制进行增减。
也可以增加 `octal` 来识别 `0` 开头的八进制数字。

---

下面列出 `vim` 自带的操作符命令：

| 命令 | 说明       |
| ---- | ---------- |
| `d`  | 删除       |
| `c`  | 更改       |
| `y`  | 复制       |
| `>`  | 向右缩进   |
| `<`  | 向左缩进   |
| `=`  | 自动缩进   |
| `g~` | 切换大小写 |
| `gu` | 转换为小写 |
| `gU` | 转换为大写 |
| `!`  | 过滤       |

上面的操作符后都可以跟一个 `motion`。当使用各自最后一个命令时会对当前行进行操作，
例如 `gUU` 会让当前行的字母全部变成大写。在可视模式下使用上述命令会作用于选择的内容。

`u`、`U`、`~` 在可视模式下与 `gu`、`gU`、`g~` 效果相同。

---

`vim` 中可以用 `CTRL-K {cahr1} {char2}` 来插入一个特殊字符，
其中 `{char1}` 和 `{char2}` 是该特殊字符的两个字母缩写。
例如 `CTRL-K <<` 会插入 `«` 字符，`CTRL-K >>` 会插入 `»` 字符。
可以通过 `:help digraphs-table` 来查看所有可用的字符缩写。这个功能用的并不多。

在普通模式下，可以通过 `ga` 来查看光标下字符的 `ASCII` 码值和 `Unicode` 码值。

---

在 `vim` 中，`CTRL-H` 在插入模式和命令行模式下其功能等同于 `Backspace` 键，
推荐使用 `CTRL-H` 来实现删除前一个字符的功能，因为其比 `Backspace` 要好按，
双手可以不用离开键盘的主区域。

在 `vim` 推荐定义以下的功能键来实现快速删除：

| 按键     | 功能                 |
| -------- | -------------------- |
| `CTRL-H` | 删除光标前的一个字符 |
| `CTRL-U` | 删除光标前的整行     |
| `CTRL-W` | 删除光标前的一个单词 |
| `CTRL-K` | 删除光标后的整行     |

**注意**：`CTRL-K` 在 `vim` 中默认是用于插入特殊字符的，但这个功能很少用到，
所以推荐将其映射为删除光标后的整行。

---

`vim` 的可视模式下可以使用 `o` 键在选区的起始位置和结束位置之间切换光标，
这在进行大块文本选择时非常有用，可以快速调整选区的范围。

---

`vim` 中 `it` 和 `at` 分别表示 "inside tag" 和 "around tag"，
可以在 `HTML` 或 `XML` 文件中使用这些文本对象来选择标签内的内容或包括标签本身的内容。

---

`vim` 中在命令行模式下可以使用 `UP` 和 `DOWN` 来浏览之前输入的命令历史，
如果已经输入了一部分命令，使用 `UP` 和 `DOWN` 进行过滤的时候则只会显示以输入内容开头的命令。

**注意**：我发现在命令行模式下使用 `CTRL-P`、`CTRL-N` 和 `ALT-P`、`ALT-N` 也可以实现同样的功能。

---

`vim` 中可以使用 `CTRL-G` 在可视模式下和选择模式下进行切换。
选择模式和可视模式的一个主要区别是，在选择模式下输入的内容会替换选中的文本，
而在可视模式下如果要替换文本需要先使用 `c` 命令进入插入模式。

选择模式往往是用于实现 `Snippets` 相关功能，实际使用中不太需要自己主动进入选择模式。

---

`vim` 中可以使用 `@:` 来重复执行上一次在命令行模式下输入的命令。
也可以使用 `&` 来重复执行上一次使用 `:substitute` 命令进行的替换操作。

`@@` 可以重复执行上一次在普通模式下使用 `@{0-9a-z":*}` 寄存器执行的宏命令。

---

`vim` 中使用 `gr` 和 `gR` （单字符和连续替换） 可以进入 `Virtual Replace` 模式。
`Virtual Replace` 和 `Replace` 模式的主要区别在于，
`Virtual Replace` 模式是按照屏幕上显示宽度进行替换的，
而 `Replace` 模式是按照实际字符进行替换的。

这在替换包含制表符的文本时非常有用。
在 `Virtual Replace` 模式下，如果当前位置是一个显示宽度为多个空格的制表符，
那么输入的字符会插入到制表符之前，当输入的字符数量达到制表符的显示宽度时，
制表符才会被替换掉。

---

`vim` 中可以使用 `CTRL-R {register}` 在插入模式或者命令行模式下插入寄存器中的内容。
除此之外，`CTRL-R CTRL-P {register}` 也可以实现类似的功能，
但它会自动调整缩进。

`CTRL-R =` 则可以在插入模式或者命令行模式下插入一个表达式的计算结果。

---

`vim` 中可以使用 `CTRL-V {digit}` 来插入特殊字符：

| 按键组合           | 说明                     |
| ---------------    | ------------------------ |
| `CTRL-V 123`       | 以十进制插入字符      |
| `CTRL-V u1234`     | 以十六进制插入 Unicode 字符 |
| `CTRL-V U12345678` | 以十六进制插入 Unicode 字符 |
| `CTRL-V o123`      | 以八进制插入字符       |
| `CTRL-V O123`      | 以八进制插入字符       |
| `CTRL-V x7B`       | 以十六进制插入字符     |
| `CTRL-V X7B`       | 以十六进制插入字符     |

`CTRL-V` 后面可以跟一个非数字字符来插入对应的控制字符，例如 `CTRL-V CTRL-M` 可以插入回车符。

---

下面列出了一些常用的 `Ex` 命令：

| 命令                    | 说明                                    |
| ------------------------| --------------------------------------- |
| `:[r]d [x]`             | 删除指定范围的行并将其存入寄存器 `x` 中 |
| `:[r]y [x]`             | 复制指定范围的行并将其存入寄存器 `x` 中 |
| `:[l]pu [x]`            | 在指定行之后粘贴寄存器 `x` 中的内容     |
| `:[l]pu! [x]`           | 在指定行之前粘贴寄存器 `x` 中的内容     |
| `:[r]t {addr}`          | 复制指定范围的行并将其存入寄存器 `x` 中 |
| `:[r]m {addr}`          | 移动指定范围的行到目标地址处            |
| `:[r]j`                 | 将指定范围的行连接成一行                |
| `:[r]norm {cmd}`        | 对指定范围的行执行普通模式下的命令      |
| `:[r]s/{p}/{s}/{flags}` | 对指定范围的行执行替换操作              |
| `:[r]g/{p}/{cmd}`       | 对指定范围内匹配模式的行执行 `Ex` 命令  |

**注意**：

- `[r]` 表示可选的范围，可以是行号、搜索模式等。
- `[l]` 表示可选的行号，默认是当前行。
- `[x]` 表示可选的寄存器名称，默认是无名寄存器。
- `{addr}` 表示目标地址，可以是行号、搜索模式等。
- `{cmd}` 表示要执行的 `Ex` 命令。
- `{p}` 表示搜索模式。
- `{s}` 表示替换字符串。
- `{flags}` 表示替换标志，例如 `g` 表示全局替换。

下面给出常用的地址表示方法：

| 地址       | 说明                     |
| ---------- | ------------------------ |
| `1`        | 第一行                   |
| `$`        | 最后一行                 |
| `0`        | 虚拟行，位于第一行之前   |
| `.`        | 当前行                   |
| `%`        | 当前文件的所有行         |
| `N`        | 第 N 行                  |
| `+N`       | 当前行向下 N 行          |
| `-N`       | 当前行向上 N 行          |
| `/pattern/`| 向下搜索匹配模式的行     |
| `?pattern?`| 向上搜索匹配模式的行     |

对于搜索的范围可以写出 `/<html>/,/<\/html>/`
来表示从第一个 `<html>` 标签所在行到第一个 `</html>` 标签所在行的范围。

例如：
`:/<html>/,/<\/html>/p` 表示打印从第一个 `<html>` 标签所在行到第一个 `</html>` 标签所在行的内容。

而搜索范围可以和 `+N` 、`-N` 结合使用，例如：
`:/<html>/+1,/<\/html>/-1d` 表示删除从第一个 `<html>` 标签下一行到第一个 `</html>` 标签上一行的内容。

对于这些命令我们也可以在 `Visual` 模式下选中后使用 `:` 进入命令行模式，
此时命令行中会自动插入 `'<,'>` 来表示选中的范围，我们只需要在后面添加命令即可。

这里再给出几个例子：

* `:%norm A;` 在每一行的末尾添加分号
* `:%norm I//` 在每一行的开头添加注释符号 `//`

---

`vim` 中可以用 `:ls` 来列出当前打开的所有缓冲区。
`%` 符号表示当前缓冲区，`#` 符号表示轮换文件。
开头的数字则表示缓冲区的编号。

- `CTRL-^` 可以在当前文件和轮换文件之间切换。
- `:b {bufnum}` 切换到指定编号的缓冲区。
- `:bp` 和 `:bn` 来在缓冲区之间切换。
- `:bf` 和 `:bl` 可以用来切换到第一个和最后一个缓冲区。
- `:bd` 可以用来 `unload` 一个缓冲区并将其从缓冲区列表中移除。
- `:bun` 可以用来 `unload` 一个缓冲区但不将其从缓冲区列表中移除。
- `:bufdo {cmd}` 可以对所有缓冲区执行指定的命令。

`Vim` 中的 `:args` 命令可以用来设置和查看参数列表。

- `:next` 和 `:prev` 可以用来在参数列表中的文件之间进行切换。
- `:argadd` 和 `:argdelete` 可以用来向参数列表中添加和删除文件。
- `:argdo {cmd}` 可以对参数列表中的所有文件执行指定的命令。

例如 `:args *.js` 会将当前目录下的所有 `js` 文件添加到参数列表中，
然后可以通过 `:next` 和 `:prev` 来切换这些文件。

我们可以使用反引号来将命令的输出作为参数列表，例如：

```vim
:args `find . -name '*.js'`
```

在使用 `:argdo {cmd}` 或者 `:bufdo {cmd}` 时，其会按照如下的逻辑进行执行：

- `:first` 或者 `:bf`
- `:{cmd}`
- `:next` 或者 `:bn`
- `:{cmd}`
- ……

当执行过程中 `:{cmd}` 进行了修改但是没有保存的时候，
`:next` 和 `:bn` 就会执行失败，
我们可以通过设置 `hidden` 选项（`Neovim` 中默认开启）来允许切换未保存修改的缓冲区。

当然我们也可以在 `:{cmd}` 结尾加上 `| update` 来保存修改，例如：
`:bufdo %s/var/let/g | update` 会对所有缓冲区进行替换并保存修改。

---

下面的一些命令可以用来处理有修改的缓冲区：

| 命令 | 说明 |
| --- | --- |
| `:w` | 保存当前缓冲区 |
| `:wa` | 保存所有缓冲区 |
| `:e` | 重新加载当前缓冲区 |
| `:qa` | 关闭所有缓冲区 |
| `:up` | 保存当前缓冲区（如果有修改） |

上面的命令都可以在结尾加上 `!` 来强制执行，例如 `:qa!` 会强制关闭所有缓冲区而不保存修改。

---

`vim` 中可以使用 `q:`、`q/` 和 `q?` 来打开命令行窗口，
分别用于查看和编辑命令行模式下的命令历史、向下搜索历史和向上搜索历史。

在命令行窗口中，你可以像编辑普通文件一样编辑命令历史，当你在任意一行上按下 `ENTER` 的时候，
该行命令将会被执行。`CTRL-C` 则会返回到命令行模式。使用 `:q` 则可以关闭命令行窗口。

如果你当前处在命令行模式下，可以直接按下 `CTRL-F` 来打开命令行窗口。

---

`vim` 的命令行模式中可以使用 `SHIFT-LEFT`（或 `CTRL-LEFT`）和 `SHIFT-RIGHT`（或 `CTRL-RIGHT`）
将光标按照单词进行移动，类似于普通模式下的 `b` 和 `w` 按键。

推荐进行如下的按键映射：

| 原按键 | 映射后      |
| ------ | ----------- |
| CTRL-B | LEFT        |
| CTRL-F | RIGHT       |
| ALT-b  | SHIFT-LEFT  |
| ALT-f  | SHIFT-RIGHT |

---

`vim` 的命令行模式下可以用 `|` 来连接多个命令，例如：
`:w | !gcc % -o %< | ./%<` 会先保存当前文件，然后编译该文件，最后运行生成的可执行文件。
可以通过 `:h bar` 来查看更多的内容。

在执行 `SHELL` 命令的时候，`vim` 会将 `%` 解析成当前文件名，
`%<` 解析成当前文件名去掉扩展名后的名称。
可以通过 `:h cmdline-special` 来查看所有可用的特殊符号。

---

`vim` 中可以通过 `:!{cmd}` 的方式来执行外部命令，当直接运行 `:!ls` 时，`vim` 会回显命令的输出，
当命令的输出比较长时，可以用 `:r !{cmd}` 的方式来将命令的输出读取到当前光标所在位置。

当前我们也可以通过 `:enew | r !{cmd}` 的方式来在一个新的缓冲区中读取命令的输出。

`:[range]w !{cmd}` 则做相反的操作，
它会将当前缓冲区的指定内容通过管道传递给外部命令 `cmd` 的标准输入。
如果不指定范围则默认是整个缓冲区的内容。

`:{range}!{filter}` 则可以对指定范围内的内容通过管道传递给外部命令 `{filter}` 的标准输入，
并将外部命令的输出替换掉指定范围内的内容。
例如 `:2,$!sort -t',' -k2` 会对从第二行到最后一行的内容按逗号分隔符的第二列进行排序。

我们可以在普通模式下通过 `!` 来进入 `Operator-pending` 的状态，
在该状态下可以使用各种 `motion` 来选择要过滤的内容。
而在可视模式下使用 `!` 则会对选中的内容进行过滤。
