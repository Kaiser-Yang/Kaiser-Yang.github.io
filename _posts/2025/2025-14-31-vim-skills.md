---
layout: post
title: Vim 常用技巧
date: 2025-12-31 15:42:58+0800
last_updated: 2026-01-10 10:53:21+0800
description: 本文介绍自己学习到的一些好用的 Vim 技巧
tags:
  - Vim
  - Neovim
categories: Potpourri
featured:
giscus_comments: true
toc:
  sidebar: left
related_posts: true
pretty_table: true
---

在 `vim` 中 `nrformats` 决定了 `CTRL-A` 和 `CTRL-X` 增减数字时所识别的数字格式，
其一般被设置成 `bin,hex` 表示会将 `0b` 和 `0B` 开头的数字识别成二进制，
`0x` 和 `0X` 开头的数字识别成十六进制。
在这些数字上使用 `CTRL-A` 和 `CTRL-X` 时会按相应的进制进行增减。
也可以增加 `octal` 来识别 `0` 开头的八进制数字。

---

下面列出 `vim` 自带的操作符命令：

| 命令 | 说明       |
| ---- | ---------- |
| `d`  | 删除       |
| `c`  | 更改       |
| `y`  | 复制       |
| `>`  | 向右缩进   |
| `<`  | 向左缩进   |
| `=`  | 自动缩进   |
| `g~` | 切换大小写 |
| `gu` | 转换为小写 |
| `gU` | 转换为大写 |
| `!`  | 过滤       |

上面的操作符后都可以跟一个 `motion`，当使用各自最后一个命令时会对当前行进行操作，
例如 `gUU` 会让当前行的字母全部变成大写。在可视模式下使用上述命令会作用于选择的内容。

`u`、`U`、`~` 在可视模式下与 `gu`、`gU`、`g~` 效果相同。

---

`vim` 中可以用 `CTRL-K {cahr1} {char2}` 来插入一个特殊字符，
其中 `{char1}` 和 `{char2}` 是该特殊字符的两个字母缩写。
例如 `CTRL-K <<` 会插入 `«` 字符，`CTRL-K >>` 会插入 `»` 字符。
可以通过 `:help digraphs-table` 来查看所有可用的字符缩写。这个功能用的并不多。

---

在 `vim` 中，`CTRL-H` 在插入模式和命令行模式下其功能等同于 `Backspace` 键，
推荐使用 `CTRL-H` 来实现删除前一个字符的功能，因为其比 `Backspace` 要好按，
双手可以不用离开键盘的主区域。

在 `vim` 推荐定义以下的功能键来实现快速删除：

| 按键     | 功能                 |
| -------- | -------------------- |
| `CTRL-H` | 删除光标前的一个字符 |
| `CTRL-U` | 删除光标前的整行     |
| `CTRL-W` | 删除光标前的一个单词 |
| `CTRL-K` | 删除光标后的整行     |

`CTRL-K` 在 `vim` 中默认是用于插入特殊字符的，但这个功能很少用到，
所以推荐将其映射为删除光标后的整行。

---

`vim` 的可视模式下可以使用 `o` 键在选区的起始位置和结束位置之间切换光标，
这在进行大块文本选择时非常有用，可以快速调整选区的范围。

---

`vim` 中 `it` 和 `at` 分别表示 "inside tag" 和 "around tag"，
可以在 `HTML` 或 `XML` 文件中使用这些文本对象来选择标签内的内容或包括标签本身的内容。

---

`vim` 中在命令行模式下可以使用 `UP` 和 `DOWN` 来浏览之前输入的命令历史，
如果已经输入了一部分命令，使用 `UP` 和 `DOWN` 进行过滤的时候则只会显示以输入内容开头的命令。

---

`vim` 中可以使用 `CTRL-G` 在可视模式下和选择模式下进行切换。
选择模式和可视模式的一个主要区别是，在选择模式下输入的内容会替换选中的文本，
而在可视模式下如果要替换文本需要先使用 `c` 命令进入插入模式。

选择模式往往是用于实现 `Snippets` 相关功能，实际使用中不太需要自己主动进入选择模式。

---

`vim` 中可以使用 `@:` 来重复执行上一次在命令行模式下输入的命令。
也可以使用 `&` 来重复执行上一次使用 `:substitute` 命令进行的替换操作。

`@@` 可以重复执行上一次在普通模式下使用 `@{0-9a-z":*}` 寄存器执行的宏命令。

---

`vim` 中使用 `gr` 和 `gR` （单字符和连续替换） 可以进入 `Virtual Replace` 模式。
`Virtual Replace` 和 `Replace` 模式的主要区别在于，
`Virtual Replace` 模式是按照屏幕上显示宽度进行替换的，
而 `Replace` 模式是按照实际字符进行替换的。

这在替换包含制表符的文本时非常有用。
在 `Virtual Replace` 模式下，如果当前位置是一个显示宽度为多个空格的制表符，
那么输入的字符会插入到制表符之前，当输入的字符数量达到制表符的显示宽度时，
制表符才会被替换掉。

---

`vim` 中可以使用 `CTRL-R {register}` 在插入模式或者命令行模式下插入寄存器中的内容。
除此之外，`CTRL-R CTRL-P {register}` 也可以实现类似的功能，
但它会自动调整缩进。

而 `CTRL-R =` 则可以在插入模式或者命令行模式下插入一个表达式的计算结果。

---

`vim` 中可以使用 `CTRL-V {digit}` 来插入特殊字符：

| 按键组合           | 说明                     |
| ---------------    | ------------------------ |
| `CTRL-V 123`       | 以十进制插入字符      |
| `CTRL-V u1234`     | 以十六进制插入 Unicode 字符 |
| `CTRL-V U12345678` | 以十六进制插入 Unicode 字符 |
| `CTRL-V o123`      | 以八进制插入字符       |
| `CTRL-V O123`      | 以八进制插入字符       |
| `CTRL-V x7B`       | 以十六进制插入字符     |
| `CTRL-V X7B`       | 以十六进制插入字符     |

`CTRL-V` 后面可以跟一个非数字字符来插入对应的控制字符，例如 `CTRL-V CTRL-M` 可以插入回车符。

---

下面列出了一些常用的 `Ex` 命令：

| 命令                                   | 说明                                    |
| -------------------------------------- | --------------------------------------- |
| `:[range]d [x]`                        | 删除指定范围的行并将其存入寄存器 `x` 中 |
| `:[range]y [x]`                        | 复制指定范围的行并将其存入寄存器 `x` 中 |
| `:[line]pu [x]`                        | 在指定行之后粘贴寄存器 `x` 中的内容     |
| `:[line]pu! [x]`                       | 在指定行之前粘贴寄存器 `x` 中的内容     |
| `:[range]t {address}`                  | 复制指定范围的行并将其存入寄存器 `x` 中 |
| `:[range]m {address}`                  | 移动指定范围的行到目标地址处            |
| `:[range]j`                            | 将指定范围的行连接成一行                |
| `:[range]norm {commands}`              | 对指定范围的行执行普通模式下的命令      |
| `:[range]s/{pattern}/{string}/{flags}` | 对指定范围的行执行替换操作              |
| `:[range]g/{pattern}/{commands}`       | 对指定范围内匹配模式的行执行 `Ex` 命令  |

下面给出常用的地址表示方法：

| 地址       | 说明                     |
| ---------- | ------------------------ |
| `1`        | 第一行                   |
| `$`        | 最后一行                 |
| `0`        | 虚拟行，位于第一行之前   |
| `.`        | 当前行                   |
| `%`        | 当前文件的所有行         |
| `N`        | 第 N 行                  |
| `+N`       | 当前行向下 N 行          |
| `-N`       | 当前行向上 N 行          |
| `/pattern/`| 向下搜索匹配模式的行     |
| `?pattern?`| 向上搜索匹配模式的行     |

对于搜索的范围可以写出 `/<html>/,/<\/html>/`
来表示从第一个 `<html>` 标签所在行到第一个 `</html>` 标签所在行的范围。

例如：
`:/<html>/,/<\/html>/p` 表示打印从第一个 `<html>` 标签所在行到第一个 `</html>` 标签所在行的内容。

而搜索范围可以和 `+N` 、`-N` 结合使用，例如：
`:/<html>/+1,/<\/html>/-1d` 表示删除从第一个 `<html>` 标签下一行到第一个 `</html>` 标签上一行的内容。

对于这些命令我们也可以在 `Visual` 模式下选中后使用 `:` 进入命令行模式，
此时命令行中会自动插入 `'<,'>` 来表示选中的范围，我们只需要在后面添加命令即可。

这里再给出几个例子：

* `:%norm A;` 在每一行的末尾添加分号
* `:%norm I//` 在每一行的开头添加注释符号 `//`

---

`vim` 中可以用 `:bp` 和 `:bn` 来在缓冲区之间切换。
`:bf` 和 `:bl` 可以用来切换到第一个和最后一个缓冲区。
`:bd` 可以用来 `unload` 一个缓冲区并将其从缓冲区列表中移除。
`:bun` 可以用来 `unload` 一个缓冲区但不将其从缓冲区列表中移除。
